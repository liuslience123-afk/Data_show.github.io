name: è‡ªåŠ¨åŒæ­¥é£ä¹¦æ•°æ®

on:
  schedule:
    - cron: '*/30 * * * *' # æ¯30åˆ†é’Ÿè¿è¡Œä¸€æ¬¡ï¼Œä½ å¯ä»¥æ ¹æ®éœ€è¦è°ƒæ•´
  workflow_dispatch:      # å…è®¸ä½ åœ¨ GitHub é¡µé¢æ‰‹åŠ¨ç‚¹å‡»æŒ‰é’®ç«‹å³æ›´æ–°

jobs:
  update-data:
    runs-on: ubuntu-latest
    steps:
      - name: æ£€å‡ºä»£ç 
        uses: actions/checkout@v3

      - name: å®‰è£… Node.js
        uses: actions/setup-node@v3
        with:
          node-version: '18'

      - name: è¿è¡ŒåŒæ­¥è„šæœ¬
        env:
          # è¿™äº›å˜é‡éœ€è¦åœ¨ GitHub Settings -> Secrets ä¸­è®¾ç½®
          FEISHU_APP_ID: ${{ secrets.FEISHU_APP_ID }}
          FEISHU_APP_SECRET: ${{ secrets.FEISHU_APP_SECRET }}
          FEISHU_SHEET_TOKEN: ${{ secrets.FEISHU_SHEET_TOKEN }}
        run: |
          mkdir -p data
          node scripts/fetch_feishu_sheet.mjs

      - name: æäº¤å¹¶æ¨é€åˆ°ä»“åº“
        run: |
          git config --global user.name "GitHub Action Bot"
          git config --global user.email "actions@github.com"
          # git add data/map_data.json
          # # å¦‚æœæ–‡ä»¶æ²¡æœ‰å˜åŒ–ï¼Œå°±ä¸æäº¤ï¼Œé˜²æ­¢æŠ¥é”™
          # git commit -m "Auto-update data from Feishu" || exit 0
          git add .
          # åŠ ä¸Š --allow-empty ç¡®ä¿å³ä½¿æ•°æ®æ²¡å˜ä¹Ÿå¼ºåˆ¶è§¦å‘ä¸€æ¬¡éƒ¨ç½²
          git commit --allow-empty -m "ğŸ”¥ å¼ºåˆ¶åˆ·æ–°ç½‘é¡µéƒ¨ç½²: $(date)"
          git push
